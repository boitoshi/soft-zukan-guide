<!-- バージョン限定フィルター機能 UI設計サンプル -->

<!-- 拡張フィルターエリア（バージョン限定対応版） -->
<div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
    <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="text-2xl mr-2">🔍</span>
        フィルター & 検索
    </h2>
    
    <!-- 第1行: 既存のフィルター -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
        <div>
            <label class="block text-sm font-medium mb-2 text-gray-700">図鑑で絞り込み</label>
            <select v-model="filters.region" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                <option value="">すべて表示</option>
                <option v-for="region in selectedGame.regions" :key="region.id" :value="region.id">
                    {{ region.name }}
                </option>
                <option value="duplicates">🔄 重複ポケモン</option>
                <option value="unique">⭐ 重複なし</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium mb-2 text-gray-700">ゲット状況</label>
            <select v-model="filters.status" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                <option value="">すべて</option>
                <option value="caught">✅ ゲット済み</option>
                <option value="not-caught">❌ 未ゲット</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium mb-2 text-gray-700">ポケモン名で検索</label>
            <input v-model="filters.search" type="text" placeholder="例: ピカチュウ" 
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
        </div>
        <div class="flex flex-col justify-end">
            <button @click="resetFilters" 
                    class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                🔄 リセット
            </button>
        </div>
    </div>
    
    <!-- 第2行: 新しいバージョンフィルター -->
    <div class="border-t pt-4">
        <h3 class="text-lg font-semibold mb-3 text-gray-800">🎮 バージョン限定フィルター</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- スカーレット・バイオレット -->
            <div v-if="zukanData.version_filters?.scarlet_violet">
                <label class="block text-sm font-medium mb-2 text-gray-700">
                    スカーレット・バイオレット
                </label>
                <select v-model="filters.scarlet_violet" 
                        class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500 focus:border-transparent">
                    <option v-for="(label, value) in zukanData.version_filters.scarlet_violet" 
                            :key="value" :value="value">
                        {{ label }}
                    </option>
                </select>
            </div>
            
            <!-- ソード・シールド -->
            <div v-if="zukanData.version_filters?.sword_shield">
                <label class="block text-sm font-medium mb-2 text-gray-700">
                    ソード・シールド
                </label>
                <select v-model="filters.sword_shield" 
                        class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option v-for="(label, value) in zukanData.version_filters.sword_shield" 
                            :key="value" :value="value">
                        {{ label }}
                    </option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- ポケモンカード（バージョンアイコン付き） -->
<div class="pokemon-card flex items-center justify-between p-4 border-b border-gray-100 hover:bg-gray-50">
    <div class="flex items-center space-x-4">
        <div class="text-2xl">
            {{ pokemon.caught ? '✅' : '⭕' }}
        </div>
        <div>
            <div class="flex items-center space-x-2">
                <div class="font-semibold text-lg" 
                     :class="pokemon.caught ? 'text-green-600' : 'text-gray-700'">
                    {{ pokemon.name }}
                </div>
                
                <!-- バージョン限定アイコン -->
                <div class="flex space-x-1">
                    <!-- スカーレット・バイオレット アイコン -->
                    <span v-if="pokemon.version_info?.scarlet_violet?.availability === 'scarlet'"
                          class="text-red-500 text-sm font-bold" title="スカーレット限定">🔴</span>
                    <span v-else-if="pokemon.version_info?.scarlet_violet?.availability === 'violet'"
                          class="text-purple-500 text-sm font-bold" title="バイオレット限定">🟣</span>
                    <span v-else-if="pokemon.version_info?.scarlet_violet?.availability === 'both'"
                          class="text-green-500 text-sm font-bold" title="スカバイ共通">🤝</span>
                    
                    <!-- ソード・シールド アイコン -->
                    <span v-if="pokemon.version_info?.sword_shield?.availability === 'sword'"
                          class="text-blue-600 text-sm font-bold" title="ソード限定">🗡️</span>
                    <span v-else-if="pokemon.version_info?.sword_shield?.availability === 'shield'"
                          class="text-gray-600 text-sm font-bold" title="シールド限定">🛡️</span>
                    <span v-else-if="pokemon.version_info?.sword_shield?.availability === 'both'"
                          class="text-green-500 text-sm font-bold" title="剣盾共通">🤝</span>
                </div>
            </div>
            
            <!-- 重複表示（既存機能） -->
            <span v-if="pokemon.regions.length > 1" 
                  class="text-xs px-2 py-1 rounded-full bg-yellow-100 text-yellow-800">
                🔄 重複
            </span>
            <span v-for="region in pokemon.regions" :key="region"
                  class="text-xs px-2 py-1 rounded-full bg-purple-100 text-purple-800 ml-1">
                {{ getRegionName(region) }}
            </span>
        </div>
    </div>
    
    <div class="text-right">
        <div class="text-sm text-gray-500 mb-1">
            <span v-for="(region, index) in pokemon.regions" :key="region">
                {{ getRegionName(region) }}図鑑 #{{ pokemon.pokedex_numbers[region] }}
                <span v-if="index < pokemon.regions.length - 1"> / </span>
            </span>
        </div>
        <div class="text-xs px-3 py-1 rounded-full" 
             :class="pokemon.caught ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
            {{ pokemon.caught ? '🎉 ゲット済み' : '🎯 未ゲット' }}
        </div>
    </div>
</div>

<!-- JavaScript フィルター機能拡張 -->
<script>
// filters に新しいフィールドを追加
const filters = ref({
    region: '',
    status: '',
    search: '',
    scarlet_violet: 'all',    // 新規追加
    sword_shield: 'all'       // 新規追加
});

// filteredPokemon computed を拡張
const filteredPokemon = computed(() => {
    let filtered = zukanData.value.pokemon || [];
    
    // 既存フィルター
    if (filters.value.region) {
        if (filters.value.region === 'duplicates') {
            filtered = filtered.filter(p => p.regions.length > 1);
        } else if (filters.value.region === 'unique') {
            filtered = filtered.filter(p => p.regions.length === 1);
        } else {
            filtered = filtered.filter(p => p.regions.includes(filters.value.region));
        }
    }
    
    if (filters.value.status) {
        filtered = filtered.filter(p => 
            filters.value.status === 'caught' ? p.caught : !p.caught
        );
    }
    
    if (filters.value.search) {
        filtered = filtered.filter(p => 
            p.name.toLowerCase().includes(filters.value.search.toLowerCase())
        );
    }
    
    // 新規バージョンフィルター
    if (filters.value.scarlet_violet && filters.value.scarlet_violet !== 'all') {
        filtered = filtered.filter(p => 
            p.version_info?.scarlet_violet?.availability === filters.value.scarlet_violet
        );
    }
    
    if (filters.value.sword_shield && filters.value.sword_shield !== 'all') {
        filtered = filtered.filter(p => 
            p.version_info?.sword_shield?.availability === filters.value.sword_shield
        );
    }
    
    return filtered;
});

// resetFilters 関数を拡張
const resetFilters = () => {
    filters.value = {
        region: '',
        status: '',
        search: '',
        scarlet_violet: 'all',
        sword_shield: 'all'
    };
};
</script>